# Railway Configuration - DannigOptica Frontend
# Documentación: https://docs.railway.app/deploy/config-as-code
#
# IMPORTANTE: El Dockerfile está en frontend/
# 1. El Root Directory en Railway Dashboard debe estar configurado como "frontend"
# 2. El dockerfilePath es "Dockerfile" (relativo a frontend/)
# 3. Las rutas en el Dockerfile NO incluyen el prefijo frontend/ (ya estamos en frontend/)
#
# Este archivo configura únicamente el servicio FRONTEND.
# Para el backend, ver railway.toml en la raíz del proyecto.

[build]
builder = "DOCKERFILE"
# Si Root Directory está configurado como "frontend", el dockerfilePath es relativo a ese directorio
# Como el Dockerfile está en frontend/, la ruta es simplemente "Dockerfile"
dockerfilePath = "Dockerfile"

# Variables de entorno para BUILD (necesarias durante el build)
# Vite necesita estas variables durante el BUILD, no en runtime
[build.env]
# VITE_API_URL debe ser proporcionada como variable de entorno en Railway Dashboard
# O actualizada aquí con la URL real del backend después del primer despliegue
# Formato: https://tu-backend.railway.app o https://backend-production.up.railway.app
VITE_API_URL = "https://dannig-optica-production.up.railway.app"
NODE_ENV = "production"

[deploy]
# No especificar startCommand - dejar que Railway use el CMD del Dockerfile
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"  # Endpoint específico para healthcheck
healthcheckTimeout = 120  # 2 minutos para dar tiempo a que nginx inicie completamente

# NOTA IMPORTANTE SOBRE VITE_API_URL: 
# 
# En Vite, las variables de entorno deben estar disponibles durante el BUILD, no en runtime.
# Por lo tanto, VITE_API_URL debe configurarse en Railway Dashboard como variable de entorno
# del servicio de frontend ANTES del primer despliegue, o actualizada aquí.
#
# PASOS PARA CONFIGURAR:
# 1. Desplegar el backend primero y obtener su URL pública de Railway
# 2. En Railway Dashboard, ir al servicio de frontend > Variables
# 3. Agregar variable: VITE_API_URL = https://tu-backend-url.railway.app
# 4. Alternativamente, actualizar el valor arriba en [build.env] y hacer commit
# 5. Hacer redeploy del frontend para que se recompile con la nueva URL
#
# CONFIGURACIÓN EN RAILWAY DASHBOARD:
# - Root Directory: frontend
# - Dockerfile Path: Dockerfile (relativo a frontend/)
# - Healthcheck Path: /health
# - Healthcheck Timeout: 120 segundos
