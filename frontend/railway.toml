# Railway Configuration - DannigOptica Frontend
# Documentación: https://docs.railway.app/deploy/config-as-code
#
# IMPORTANTE: Este archivo será usado automáticamente cuando:
# 1. Creas un servicio "Frontend" en Railway Dashboard
# 2. Configuras el Root Directory como "frontend"
# 3. Railway detectará este railway.toml en frontend/
#
# Este archivo configura únicamente el servicio FRONTEND.
# Para el backend, ver railway.toml en la raíz del proyecto.

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

# Variables de entorno para BUILD (necesarias durante el build)
# Vite necesita estas variables durante el build, no en runtime
[build.env]
# VITE_API_URL debe ser proporcionada como variable de entorno en Railway Dashboard
# O actualizada aquí con la URL real del backend después del primer despliegue
# Formato: https://tu-backend.railway.app o https://backend-production.up.railway.app
VITE_API_URL = "https://tu-backend-url.railway.app"
NODE_ENV = "production"

[deploy]
# Especificar startCommand explícitamente - nginx:alpine no tiene bash, solo sh
# Ejecutar nginx directamente sin bash - Railway usará sh para ejecutar este comando
startCommand = "nginx -g 'daemon off;'"
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/"
healthcheckTimeout = 300  # 5 minutos para inicialización

# NOTA IMPORTANTE SOBRE VITE_API_URL:
# 
# En Vite, las variables de entorno deben estar disponibles durante el BUILD, no en runtime.
# Por lo tanto, VITE_API_URL debe configurarse en Railway Dashboard como variable de entorno
# del servicio de frontend ANTES del primer despliegue, o actualizada aquí.
#
# PASOS PARA CONFIGURAR:
# 1. Desplegar el backend primero y obtener su URL pública de Railway
# 2. En Railway Dashboard, ir al servicio de frontend > Variables
# 3. Agregar variable: VITE_API_URL = https://tu-backend-url.railway.app
# 4. Alternativamente, actualizar el valor arriba en [build.env] y hacer commit
# 5. Hacer redeploy del frontend para que se recompile con la nueva URL
